# TEC-8 实验平台数字钟（EPM7128）说明

## 功能概述
- 6 位显示：HHMMSS（时-分-秒）
- 计时节拍：使用外部 1kHz 时钟输入分频得到 1Hz 计时
- 计数控制：运行/暂停
- 校时：选择字段并用脉冲加 1
- 闹钟：设置闹钟时间，到点响铃并支持消音
- 复位：异步低有效复位

## 数码管输出方式
- LG1（第 1 个数码管）：直接输出 7 段段码，按共阴极显示（段信号高电平点亮）
- LG2~LG6（其余 5 个数码管）：输出 4 位 BCD（0~9），由实验板上的译码电路显示
在闹钟设置模式下，显示内容切换为闹钟时间（秒显示为 00），便于校对闹钟参数。


本工程显示位分配如下：
- LG1：秒个位（H10）——7 段段码输出
- LG2：秒十位（H1）——BCD 输出
- LG3：分钟个位（M10）——BCD 输出
- LG4：分钟十位（M1）——BCD 输出
- LG5：小时个位（S10）——BCD 输出
- LG6：小时十位（S1）——BCD 输出

## 引脚与信号（以工程 .qsf 为准）
顶层模块名：`test_clock`

引脚对照表（信号名/管脚号/板上功能）：

- `rst_n` / PIN_1 / CLR#（复位，低有效）
- `clk` / PIN_57 / CP2（建议 1kHz 输入时钟）
- `inc` / PIN_61 / PULSE（加 1 脉冲）
- `start` / PIN_81 / K1（运行/暂停；设置模式下用于切换字段/消音）
- `stop` / PIN_80 / K2（进入/退出设置模式；响铃时可消音）
- `alarm_en` / PIN_79 / K3（闹钟使能：1启用，0关闭并停铃）
- `mode_alarm` / PIN_67 / K12（设置对象：0设置当前时间，1设置闹钟时间）
- `fast` / PIN_65 / K13（保留输入，不影响功能）
- `alarm` / PIN_52 / LG1-D7/SPEAKER（无源扬声器脉冲输出；设置模式下为闪烁指示）

## 使用方法
### 1) 正常计时
- 上电后默认运行。
- 拨动/按下 `start` 产生一次上升沿：运行 ↔ 暂停。

### 2) 进入校时
- 拨动/按下 `stop` 产生一次上升沿：进入/退出校时模式。
- 校时模式下：
- `mode_alarm=0`（校准当前时间）：计时暂停
- `mode_alarm=1`（设置闹钟）：当前时间继续计时
  - `alarm` 以约 1Hz 闪烁作为提示

### 3) 选择校时字段
- 校时模式下，`start` 每次上升沿切换字段：小时 → 分钟 → 秒 →（回到）小时。
- 被选中的字段会闪烁显示，提示当前正在修改的字段。

### 4) 对当前字段加 1
- 校时模式下，`inc` 每次上升沿对当前字段加 1：
  - 小时范围 00~23
  - 分钟范围 00~59
  - 秒范围 00~59
-
校时设置规则：
- 设置某一字段时，只对该字段循环加 1（到上限回到 00），不会对更高位产生进位。

## 闹钟功能
### 1) 启用/关闭闹钟
- `alarm_en=1` 启用闹钟比较；`alarm_en=0` 关闭闹钟并立即停止响铃。

### 2) 设置闹钟时间
- 按 `stop` 进入设置模式。
- 将 `mode_alarm` 置 1，进入闹钟设置。
- 按 `start` 在“闹钟小时/闹钟分钟”之间切换。
- 被选中的字段会闪烁显示。
- 按 `inc` 对当前字段加 1（闹钟小时 00~23，闹钟分钟 00~59）。
- 再按 `stop` 退出设置模式。
-
闹钟设置规则：
- 设置闹钟分钟到 59 再加 1 会回到 00，不会进位到闹钟小时。

### 3) 响铃与消音
- 当当前时间到达“闹钟小时:闹钟分钟:00”时开始响铃。
- 闹钟比较发生在 00 秒的计时节拍上。
- 响铃持续约 30 秒，或按 `start` / `stop` 消音，或将 `alarm_en` 置 0 关闭闹钟。

无源扬声器说明：
- 响铃时 `alarm` 输出为脉冲方波（由 `clk` 分频/门控得到），用于驱动无源扬声器发声。

## 整点报时
- 每到整点（HH:00:00）触发报时，`alarm` 输出脉冲方波约 2 秒。
- 若整点与闹钟同时触发，优先按闹钟响铃处理。

## 代码与工程文件
- 顶层代码：[teat_clock.v](file:///c:/clock/teat_clock.v)
- 引脚约束：[teat_clock.qsf](file:///c:/clock/teat_clock.qsf)
